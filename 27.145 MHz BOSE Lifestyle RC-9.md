# 27.145 MHz BOSE Lifestyle RC-9 (Europe) with Arduino

Remote Control RC9 für Lifestyle 3 5 8 12

 * BOSE PCB is __HCMK-C2X__
 * Main IC is __NEC D6121G 001 0207D3001__ ([data sheet](http://www.datenblatt-pdf.com/download.php?id=647260))
 * Ceramic Resonator is __CSB 455J__ (430-519 kHz according to data sheet; needed by the NEC D6121G)
 * Crystal is __RALTRON 27.145-30 02 CYH 04__

### Measured with Saleae Logic on D6121G pin 7 = REM

On pin 7 = REM, there is for the ON/OFF key an infrared-like signal `protocol = NEC2, device = 186, subdevice = 85, obc = 76` with one repetition after 39 ms, modulated with 38 kHz and 33% duty cycle (not all keys seem to have this repetition). The same signal but not modulated with 38 kHz can be seen at L2 near the transmitting antenna.

![bildschirmfoto 2016-12-16 um 23 12 31](https://cloud.githubusercontent.com/assets/2480569/21288353/3476534c-c481-11e6-8faf-3197cb1ed768.png)
![bildschirmfoto 2016-12-16 um 23 14 51](https://cloud.githubusercontent.com/assets/2480569/21288355/35e160fa-c481-11e6-8af2-0f57fe814df4.png)

Wait, these signals look familiar. This is a variant of the well-known NEC infrared protocol that is used by many infrared-controlled devices. But instead of sending the signals using a 940 nm infrared LED pulsating at 38 kHz, they are using an antenna pulsating at 27.145 MHz for the periods marked with "+" below. I used the awesome [IrScrutinizer](http://www.harctoolbox.org/IrScrutinizer.html) tool to verify my hypothesis by generating some NEC codes. Then I checked the irdb infrared database, one of the largest crowd-sourced, manufacturer-independent databases of infrared remote control codes on the web. And indeed, I found [this set of BOSE codes](https://github.com/probonopd/irdb/blob/master/codes/Bose/Lifestyle/186%2C85.csv). Using [IrScrutinizer](http://www.harctoolbox.org/IrScrutinizer.html), it was easy to calculate the "clean" (calculated rather than measured) codes for all BOSE commands.

Hence I assume that these are the valid signals in nanoseconds, with "+" being "27.145 MHz on", and "-" = off:

```
MUTE

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

VOLUME -

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

VOLUME +

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

AM/FM

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

SURROUND -

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

SURROUND +

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

VIDEO 2

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

VIDEO 1

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

AUX

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628

SKIP <<

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -38628

SKIP >>

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -38628

STOP

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -38628

2 SP

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -38628

ON/OFF

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -38628

5 SP

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -38628

3 SP

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -38628

TAPE

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

CD

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

PLAY

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

PAUSE

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

RANDOM

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

NEXT DISC

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -38628

MUTE ALL

+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -38628
```

In other words:

```
MUTE: NEC2 Device: 186.85 Function: 1 S=85

VOLUME -: NEC2 Device: 186.85 Function: 2 S=85

VOLUME +: NEC2 Device: 186.85 Function: 3 S=85

AM/FM: NEC2 Device: 186.85 Function: 6 S=85

SURROUND -: NEC2 Device: 186.85 Function: 10 S=85

SURROUND +: NEC2 Device: 186.85 Function: 11 S=85

VIDEO 2: NEC2 Device: 186.85 Function: 13 S=85

VIDEO 1: NEC2 Device: 186.85 Function: 14 S=85

AUX: NEC2 Device: 186.85 Function: 15 S=85

SKIP <<: NEC2 Device: 186.85 Function: 24 S=85

SKIP >>: NEC2 Device: 186.85 Function: 25 S=85

STOP: NEC2 Device: 186.85 Function: 26 S=85

2 SP: NEC2 Device: 186.85 Function: 75 S=85

ON/OFF: NEC2 Device: 186.85 Function: 76 S=85

5 SP: NEC2 Device: 186.85 Function: 78 S=85

3 SP: NEC2 Device: 186.85 Function: 79 S=85

TAPE: NEC2 Device: 186.85 Function: 82 S=85

CD: NEC2 Device: 186.85 Function: 83 S=85

PLAY: NEC2 Device: 186.85 Function: 85 S=85

PAUSE: NEC2 Device: 186.85 Function: 86 S=85

RANDOM: NEC2 Device: 186.85 Function: 92 S=85

NEXT DISC: NEC2 Device: 186.85 Function: 93 S=85

MUTE ALL: NEC2 Device: 186.85 Function: 223 S=85
```

### Ideas

 * Buy a garage door opener sender and try to attach it to an Arudino to replay the BOSE signals?
 * Can I see and decode the signal in using a RTL SDR? -> YES, using Gqrx-x86_64.AppImage
 * sudo rmmod r820t rtl2832 dvb_usb_rtl28xxu rtl2830 dvb_usb_rtl28xxu dvb_usb_v2 dvb_core then CubicSDR-0.2.0-x86_64.AppImage
 * How can I use Arduino to generate these signals?
  
![gqrx_wf_20161127_153832](https://cloud.githubusercontent.com/assets/2480569/20649713/dc386ea6-b4c5-11e6-8e54-725710d34a90.png)

* Here someone suggests https://discuss.ninjablocks.com/t/rtl-sdr-and-usb-receivers-for-433mhz-devices-and-lots-of-other-frequencies/1426/8 "I was wondering if this PiFm 'hack' http://www.icrobotics.co.uk/wiki/index.php/Turning_the_Raspberry_Pi_Into_an_FM_Transmitter38 , an rtl-sdr and a 20 cm piece of wire would help to provide a generic RC tranciever unit for a ninjablock. At present it seems that this is limited 1Mhz up to 250Mhz - so my Bose is in"

## FCC

So far I did not find RC-9 in the FCC database but other (possibly similar?) devices.

### Remote 1: AV35
 
Transceiver Test Report for FCC ID: A94402455 says:

The 27.145 MHz TX in the console sends out a data packet with a duty cycle of 32.5% maximum.  The transmit sequence has the following segments: 

*  2.6 ms of low level carrier only (-16 dBc) 
*  5.09 ms of full power carrier 
*  31 characters of transmitted information – maximum length is 52 ms. Duty cycle is 50% during those 52 ms

Source: https://fccid.io/document.php?id=1264358

### Remote 2: AV18 (BOSE LIFESTYLE® 38 and 48)

Pulsed (On-off keying, OOK). According to Wikipedia, On-off keying (OOK) denotes the simplest form of amplitude-shift keying (ASK) modulation that represents digital data at the presence or absence of a carrier wave.

Here is another signal from another transmitter that looks similar but is different:
https://apps.fcc.gov/eas/GetApplicationAttachment.html?id=430253

### Remote 3:  RC35S2-27 remote control for the second zone of Bose V25/V35 Lifestyle systems

https://apps.fcc.gov/eas/GetApplicationAttachment.html?id=1274121

Signal again looks similar. 4 iterations

## Generating these signals with Arudino

Might be possible with a AD9850 module
http://blog.riyas.org/2014/06/computer-controlling-27mhz-remote-control-car-ad9850-dds.html

Or with a Si4012. The Si4012 is a fully integrated FSK/OOK crystal-less CMOS high-data rate RF transmitter designed for the sub-GHz ISM band. 
http://www.silabs.com/products/wireless/EZRadio/Pages/si4012.aspx

## Generating these signals with Raspberry Pi

Known working with https://github.com/bskari/pi-rc

```
sudo ./pi_pcm -v
cat mute.json > /dev/udp/127.0.0.1/12345
```

This is the contents of mute.json, which is a representation of the MUTE timings `+9024 -4512 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -1692 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -564 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -1692 +564 -38628`:

```
[
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 9024,
        "spacing_us": 4512,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 3
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 2
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 1
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 564,
        "repeats": 8
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692,
        "repeats": 7
    },
    {
        "frequency": 27.145,
        "dead_frequency": 49.830,
        "burst_us": 564,
        "spacing_us": 1692000, 
        "repeats": 1
    }
]
```

## Generating these signals with ESP8266

Might be possible with something along the lines of https://github.com/cnlohr/channel3. To be investigated.

## Analyzing these signals

Analyzing the signal timing on the original remote is possible using a Saleae Logic Analyzer as shown above. But once I had built my own sender, I wanted to measure the signal on the air. In hindsight, it would not have been necessary to open the original remote, but I was curious what was inside anyway.

Analyzing the signal timing on the air is possible with an [RTL SDR dongle](http://www.rtl-sdr.com/buy-rtl-sdr-dvb-t-dongles/), [gqrx](http://gqrx.dk), and Audacity. Using [gqrx](http://gqrx.dk), convert the signals to audio. Play around with the settings until you hear clear "blip, blip" signals when you press keys on the remote. Then record it. Then open it in Audacity. Looks like this:

<img width="784" alt="Audacity" src="https://cloud.githubusercontent.com/assets/2480569/21288297/9d4aeed4-c47f-11e6-9379-1da1f1a1242b.png">
